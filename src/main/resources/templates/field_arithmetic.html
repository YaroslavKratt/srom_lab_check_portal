<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{head}"></head>
<body>

<!-- Navbar -->
<div th:replace="~{navbar.html}"></div>

<!-- Main Content -->
<div class="container px-3 py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h2 class="page-title" style="color: #1e293b; font-weight: 700;" th:text="#{page.navbar.field.arithmetic}">Finite Field Arithmetic</h2>
            <p class="page-subtitle" style="color: #64748b;" th:text="#{message.subtitle.field.arithmetic}">Calculate finite field operations</p>
        </div>
    </div>

    <!-- Form -->
    <form id="finiteFieldForm" th:object="${finiteFieldDto}" method="post">
        <!-- Input Card -->
        <div class="card shadow-sm mb-4 form-card" style="border-radius: 1rem; border: none;">
            <div class="card-body p-4">
                <div class="row">
                    <!-- Basis -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="basis" th:text="#{message.choose.basis}" class="form-label">Basis</label>
                            <select class="form-control custom-select" id="basis" name="basis">
                                <option value="POLYNOMIAL" th:text="#{basis.polynomial}">POLYNOMIAL</option>
                            </select>
                        </div>
                    </div>

                    <!-- Variant -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="variant" th:text="#{message.choose.variant}" class="form-label">Variant</label>
                            <select class="form-control custom-select" id="variant" th:field="*{variant}">
                                <option th:each="variant : ${finiteFieldDto.variantsToPolynomials}"
                                        th:value="${variant.key}"
                                        th:text="${variant.key + ': ' + variant.value}"></option>
                            </select>
                        </div>
                    </div>

                    <!-- Number System -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="numberSystemSelect" th:text="#{message.choose.number.system}" class="form-label">Number System</label>
                            <select class="form-control custom-select" id="numberSystemSelect" th:field="*{numberSystem}">
                                <option value="HEX" th:text="#{number.format.hex}">HEX</option>
                                <option value="BIN" th:text="#{number.format.bin}">Binary</option>
                                <option value="DECIMAL" th:text="#{number.format.dec}">Decimal</option>
                            </select>
                        </div>
                    </div>

                    <!-- First Number -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="fnumber" th:text="#{messages.first.number}" class="form-label">Number A</label>
                            <input type="text"
                                   class="form-control"
                                   id="fnumber"
                                   th:field="*{firstNumber}"
                                   th:classappend="${#fields.hasErrors('firstNumber')} ? 'is-invalid'"
                                   th:placeholder="#{placeholder.number.a}" />
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('firstNumber')}" th:errors="*{firstNumber}"></div>
                        </div>
                    </div>

                    <!-- Second Number -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="snumber" th:text="#{messages.second.number}" class="form-label">Number B</label>
                            <input type="text"
                                   class="form-control"
                                   id="snumber"
                                   th:field="*{secondNumber}"
                                   th:classappend="${#fields.hasErrors('secondNumber')} ? 'is-invalid'"
                                   th:placeholder="#{placeholder.number.b}" />
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('secondNumber')}" th:errors="*{secondNumber}"></div>
                        </div>
                    </div>

                    <!-- Third Number -->
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="form-group">
                            <label for="module" th:text="#{messages.third.number}" class="form-label">Number C</label>
                            <input type="text"
                                   class="form-control"
                                   id="module"
                                   th:field="*{thirdNumber}"
                                   th:classappend="${#fields.hasErrors('thirdNumber')} ? 'is-invalid'"
                                   th:placeholder="#{placeholder.number.c}" />
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('thirdNumber')}" th:errors="*{thirdNumber}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="button-wrapper">
            <div class="row">
                <div class="col text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="confirmCalculationButton" th:text="#{message.button.calculate}">Calculate</button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="cards" style="display: none;">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">A + B = </h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-sum"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">A * B = </h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-multiplication"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">A<sup>2</sup></h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-square"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">A<sup>C</sup></h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-pow"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">TRACE(A) = </h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-trace"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
                        <div class="card shadow result-card">
                            <div class="card-body">
                                <div class="result-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                                        <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
                                    </svg>
                                </div>
                                <h5 class="card-title">INVERSE(A) = </h5>
                                <div class="result-value">
                                    <p class="card-text" id="result-reverse"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Footer -->
<div th:replace="~{footer.html}"></div>

<!-- Localized messages for JavaScript -->
<script th:inline="javascript">
    window.i18n = window.i18n || {};
    window.i18n.calculating = /*[[#{error.calculating}]]*/ 'Calculating...';
    window.i18n.errorOccurred = /*[[#{error.general.message}]]*/ 'An unexpected error occurred. Please try again later.';
    window.i18n.fillAllFields = /*[[#{error.empty.field}]]*/ 'Please fill in all required fields';
</script>

<!-- Scripts -->
<script th:replace="~{scripts}"></script>

<!-- Async Form Submission Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('finiteFieldForm');
    const cardsSection = document.getElementById('cards');
    const calculateBtn = document.getElementById('confirmCalculationButton');

    function showSpinner(text) {
        // Remove existing spinner if any
        hideSpinner();

        const overlay = document.createElement('div');
        overlay.className = 'custom-spinner-overlay';
        overlay.id = 'calculation-spinner';
        overlay.innerHTML = '<div class="custom-spinner">' +
            '<div class="custom-spinner-circle">' +
            '<div class="custom-spinner-inner"></div>' +
            '</div>' +
            '<div class="spinner-text">' + text + '</div>' +
            '</div>';
        document.body.appendChild(overlay);
    }

    function hideSpinner() {
        const spinners = document.querySelectorAll('.custom-spinner-overlay');
        spinners.forEach(function(spinner) {
            spinner.parentNode.removeChild(spinner);
        });
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Validate required fields
        const firstNumber = document.getElementById('fnumber').value.trim();
        const secondNumber = document.getElementById('snumber').value.trim();
        const thirdNumber = document.getElementById('module').value.trim();

        if (!firstNumber || !secondNumber || !thirdNumber) {
            alert(window.i18n.fillAllFields);
            return;
        }

        // Show spinner
        showSpinner(window.i18n.calculating);

        // Disable button
        calculateBtn.disabled = true;

        // Prepare data
        const data = {
            firstNumber: firstNumber,
            secondNumber: secondNumber,
            thirdNumber: thirdNumber,
            numberSystem: document.getElementById('numberSystemSelect').value,
            variant: document.getElementById('variant').value,
            basis: document.getElementById('basis').value
        };

        try {
            const response = await fetch('/api/calculate-finite-field', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            // Hide spinner immediately after response
            hideSpinner();

            const result = await response.json();

            if (result.success) {
                // Update results
                document.getElementById('result-sum').textContent = result.sum || '';
                document.getElementById('result-multiplication').textContent = result.multiplication || '';
                document.getElementById('result-square').textContent = result.square || '';
                document.getElementById('result-pow').textContent = result.pow || '';
                document.getElementById('result-trace').textContent = result.trace || '';
                document.getElementById('result-reverse').textContent = result.reverse || '';

                // Show results section
                cardsSection.style.display = 'block';

                // Scroll to results
                cardsSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Error: ' + (result.error || 'Calculation failed'));
            }
        } catch (error) {
            console.error('Error:', error);
            hideSpinner();
            alert(window.i18n.errorOccurred);
        } finally {
            // Re-enable button
            calculateBtn.disabled = false;
        }
    });
});
</script>

</body>
</html>
